/*
 * IF_MCAN.c
 *
 *  Created on: 24 Jan 2026
 *      Author: harik
 */

#include <Level_02_Interfaces/Interface_Libraries/L02_Return_Types.h>
#include <Level_04_HAL/HAL_Libraries/HAL_Return_Types.h>
#include <Level_Libraries/iLLD/TC37A/Tricore/Cpu/Std/Platform_Types.h>

//DEBUG LINES START
#include <Level_Libraries/iLLD/TC37A/Tricore/CAN/Std/IfxCan.h>
#include <Level_Libraries/Infra/Sfr/TC37A/_Reg/IfxCan_reg.h>
volatile uint32 g_mcan_trace = 0x11111111U;
//DEBUG LINES END



extern HAL_Return_Type Func_MCAN0_Module_init(void);
extern HAL_Return_Type Func_switch_MCAN0_N0_clock_on(void);
extern HAL_Return_Type Func_run_MCAN0_RAM_init(void);

extern HAL_Return_Type Func_set_MCAN0_N0_init_on(void);
extern HAL_Return_Type Func_set_MCAN0_N0_init_off(void);

extern HAL_Return_Type Func_set_MCAN0_N0_control(void);
extern HAL_Return_Type Func_set_MCAN0_N0_Nominal_Baudrate(void);

extern HAL_Return_Type Func_set_MCAN0_N0_Data_Baudrate(void);

extern HAL_Return_Type Func_MCAN0_N0_Port_connection_init(void);

extern HAL_Return_Type Func_MsgRAM_init(void);
extern HAL_Return_Type Func_CAN0_Tx_buffer0_init(uint8 msg_nr);

/* HAL TX  */
extern HAL_Return_Type Func_MCAN0_N0_TxBuffer0_Send_u16(uint16 value);


/*
 * Interface: Init
 *  */
L02_Return_Type IF_MCAN_Init(void)
{
    //DEBUG LINES START
    g_mcan_trace = 0xAAAAAAAAU;
    //DEBUG LINES end


    L02_Return_Type tmp_L02 = L02_E_NOT_OK;
    HAL_Return_Type tmp_HAL = HAL_E_NOT_OK;

    tmp_HAL = Func_MCAN0_Module_init();
    g_mcan_trace = 0xA1A1A1A1U;

    if (tmp_HAL == HAL_E_OK) tmp_HAL = Func_switch_MCAN0_N0_clock_on();
    g_mcan_trace = 0xA2A2A2A2U;

    if (tmp_HAL == HAL_E_OK) tmp_HAL = Func_run_MCAN0_RAM_init();
    g_mcan_trace = 0xA3A3A3A3U;


    if (tmp_HAL == HAL_E_OK) tmp_HAL = Func_set_MCAN0_N0_init_on();
    g_mcan_trace = 0xA4A4A4A4U;


    if (tmp_HAL == HAL_E_OK) tmp_HAL = Func_set_MCAN0_N0_control();
    g_mcan_trace = 0xA5A5A5A5U;


    if (tmp_HAL == HAL_E_OK) tmp_HAL = Func_set_MCAN0_N0_Nominal_Baudrate();
    g_mcan_trace = 0xA6A6A6A6U;


    if (tmp_HAL == HAL_E_OK) tmp_HAL = Func_set_MCAN0_N0_Data_Baudrate();
    g_mcan_trace = 0xA7A7A7A7U;



    if (tmp_HAL == HAL_E_OK) tmp_HAL = Func_MCAN0_N0_Port_connection_init();
    g_mcan_trace = 0xA8A8A8A8U;



    if (tmp_HAL == HAL_E_OK) tmp_HAL = Func_MsgRAM_init();
    g_mcan_trace = 0xA9A9A9A9U;



    if (tmp_HAL == HAL_E_OK) tmp_HAL = Func_CAN0_Tx_buffer0_init(0);

    g_mcan_trace = 0xAAAAAAA1U;


    //if (tmp_HAL == HAL_E_OK) tmp_HAL = Func_set_MCAN0_N0_init_off();

    //DEBUG LINES START

    if (tmp_HAL == HAL_E_OK)
    {
        g_mcan_trace = 0xBBBBBBBBU;
        g_cccr_before_init_off = CAN0_CCCR0.U;
        tmp_HAL = Func_set_MCAN0_N0_init_off();
        g_mcan_trace = 0xCCCCCCCCU;
        g_init_off_status = (tmp_HAL == HAL_E_OK) ? 1U : 0U;
        g_cccr_after_init_off = CAN0_CCCR0.U;
    }
    //DEBUG LINES END

    if (tmp_HAL == HAL_E_OK) tmp_L02 = L02_E_OK;

    return tmp_L02;
}


/*
 * Interface: Send 16-bit value
  */
L02_Return_Type IF_MCAN_Send_u16(uint16 value)
{
    L02_Return_Type tmp_L02 = L02_E_NOT_OK;

    if (Func_MCAN0_N0_TxBuffer0_Send_u16(value) == HAL_E_OK)
    {
        tmp_L02 = L02_E_OK;
    }

    return tmp_L02;
}
